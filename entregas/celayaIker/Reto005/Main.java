package entregas.celayaIker.Reto005;

import java.util.*;

public class Main {

    static final int FILA = 0;
    static final int COLUMNA = 1;

    static final int ARRIBA = 0;
    static final int ABAJO = 1;
    static final int IZQUIERDA = 2;
    static final int DERECHA = 3;
    static final int SALIR = 4;
    static final int CAMBIA_VISUALIZACION = 5;
    static final int NADA = 999;

    static final int VISUALIZACION_NORMAL = 0;
    static final int VISUALIZACION_SIN_COLOR = 1;
    static final int VISUALIZACION_RAW = 2;
    static final int VISUALIZACION_COLISIONES = 3;

    static final int[][] MOVIMIENTO = {
            { -1, 0 },
            { 1, 0 },
            { 0, -1 },
            { 0, 1 }
    };

    static double hora = 9.0;
    static int alcanceVision;
    static int viewPort;
    static int modoVisualizacion = VISUALIZACION_NORMAL;

    static int minFila, minColumna, maxFila, maxColumna;

    static boolean jugando = true;

    public static void main(String[] args) {

        String[] dosCastillos = {
                "............................................................................................................................................................",
                "............................................................................................................................................................",
                "..............................................................................                                                                              ",
                "..............................................................................                                                                              ",
                "..............................................................................                                                                              ",
                "..............................................................................                                                                              ",
                "..............................................................................                                                                              ",
                "..............................................................................                                                                              ",
                "..............................................................................                                                                              ",
                "..............                                                   .............                                                                              ",
                "............                                                       ...........                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
                "...........                                                         ..........                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
                "..........      ..................................                   .........                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
                "..........    .....................................          ....    .........                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
                ".........    .......................................        ......    ........                              |----------------|%%%%%%%%%%%%%%%%%%%%%%%       ",
                ".........    ..|-----|..........|-------------|.....    .|-----|..    ........                              |   ###%%%%###   |%%%%%%%%%%%%%%%%%%%%%%%       ",
                ".........   ...|::+::|..........O+++++++++++++|....    ..|::+::|...   ........                              |   ##      ##   |%%%%%%%%%%%%%%%%%%%%%%%       ",
                ".........   ...|:+++:|..........|+++++++++++++|...    ...|:+++:|...   ........                    |------|  |   #  ****  #   |%%%%%%%%%%%%%%%%%%%%%%%       ",
                ".........   ...|+++++------------++|-------|++------------+++++|...   ........                    |******|  |     #****#     |%%%%%%%%%%%%%%%%%%%%%%%       ",
                ".........   ...|:++++++++++++++++++|#######|++++++++++++++++++:|...   ........       |--------|----******---|     #****#     |---------###%%%%%%%%%%%       ",
                ".........   ...|::+++++++++++++++++|::###::|+++++++++++++++++::|...   ........       |===*****|******||*****|     #****#     |%%%*****O**#%%%%%%%%%%%       ",
                ".........   ...---|++|-------|-+++-|:*#*#*:|-----|---|---|++|---...   ........       |+===****|XX****||*****|    ###**###    |%%******|**#%%%%%%%%%%%       ",
                ".........   ......|++|---O---|+++++|*******|#####|+++-$$$|++|......   ........       |++|------XX|-----O-|**|    #%%**%%#    |%**|-----###%%%%%%%%%%%       ",
                ".........   ......|++|*#***#*|+++++|*******|#####-+++O*$$|++|......   ........       |++|******XX|*******|**|    #%%**%%#    |%****|%%%%%%%%%%%%%%%%%       ",
                ".........    .....|++|*#***#*|+++++|*******|+++++X+++|**$|++|......   ........       |++|********|*******|**|    #%%**%%#    |*****|%%%%%%%%%%%%%%%%%       ",
                ".........    .....|++|*#####*|+++++O*******|+++++X+++|---|++|......   ........       |++|-**------**-|---|**|    ###**###    |*****|%%%%%%%%%%%%%%%%%       ",
                ".........     ....|++|*******|--+--|--***--|+++++X+++-**$|++|......   ........       |++|#**#%%%%#**#|%%%|**-------****-------**|**|%%%%%%%%%%%%%%%%%       ",
                ".........      ...|++|--***--|+++++|::+++::|+++++|+++O*$$|++|......   ........       |++|%**%%%%%%***|%%%|**********************|**|%%%%%%%%%%%%%%%%%       ",
                ".........       ..|++|+++++++|+++++|:+++++:|+++++|+++|$$$|++|......   ........       |++|%**%|-|%%***|%%%|**********************|XX|%%%%%%%%%%%%%%%%%       ",
                "..........      ..|++|+##+##+|------+++++++--+++|---|----|++|......   ........       |++|**%%|-|%%#**|%%=|-------------|--|-----|XX---|%%%%%%%%%%%%%%       ",
                "...........      .|++|+++++++|++++++++++++++++++|***|**#*|++|......   ........       |++|***%---%%***|%==|    *****    |**|=%%%%|XX***|%%%%%%%%%%%%%%       ",
                "...........       |++|+##+##+|++++++++++++++++++|---|**##|++|......   ........       |++|*#*%***%***%|===|             |**|==%%%|*****-----------|--|       ",
                "............      |++|+++++++|++++++++++++++++++|********|++|......   ........       |++|%*********#%|===|     ***     |**|===|---||***%#%#%#%-**|%%|       ",
                "............      |++|+##+##+--++|----+++----|++|***|****|++|......   ........       |++|%%*|***|*%%%|+==|    *+++*    |**|===||++||**********O**O*%|       ",
                "...........      .|++|+++++++++++|:::+++++:::|++-------**|++|......   ........       |++|%%%|***|%%%%|++=|    **+***   --O|=+=||++|-***%#%#%#%-**|%%|       ",
                "...........     ..|++|++++++++++:|::+++++++::|+++++++++++|++|......   ........       |++-----***------+++|    |#+#|*    **|+++||++|***|----------|%%|       ",
                "..........      ..|++|-------|+::|:+++++++++:|+++++++++++|++|......   ........       |++++++++++++++XX+++|    |+++|*******|+++--++|***-******%%%%|%%|       ",
                "..........     ...|++|*******|----++++   ++++-------|----|++|......   ........       |++++++++++++++XX+++------#+#---------+++XX++|***********%%%|%%|       ",
                ".........      ...|++|**|---*|+++++++     ++++++++++|++++|++|......   ........       --------|-------|+++++++#=+++=#++++++++++XX++|***********%%%|%%|       ",
                ".........     ....|++|**|*#**|+++++++     ++++++++++O++++|++|......   ........               |%%%%%%||++++++++++++++++++++++++|--------**%%***%%%|%%|       ",
                ".........     ....|++|**|*#**|+++++++     ++++++++++|++++|++|......   ........          |-----%%%%%%||++++++++++++++++++++++++|++++++++%%%%%***%%|%%|       ",
                ".........    .....|++|**--|**|++++++++   ++++|-------++++|++|......   ........          |*%%%%%%||%%|------------------***----|+++++++%%%%%%***%*|%%|       ",
                ".........    .....|++|****|**|++++++++++++++:|+++++++++++|++|......   ........          |**%%*%%||%%|                ##***#   |++--|-|%%%%%%%*****%%|       ",
                ".........   ......|++|--**----+++++++++++++::|+-+++++++++|++|......   ........          |%*|-O------|               #*****#   |++++|||%%%%%%***%***%|       ",
                ".........   ......|++|++++++++++++++++++++:::|+++++++++++|++|......   ........          |**|%*%%%%%%|               #****#    |++++|||+%%%%%**%%%|---       ",
                ".........   ......|++|-------------|--+++--|----|+++|----|++|......   ........          |**|%%%%%%%%|              #***##     |-|++|||++|---++|---          ",
                ".........   ......|++|XXXXXXXXXXXXX|::+++::|#***|+++|***#|++|......   ........          |*%------|%%|------|    |---***---|   |--++|--++|+++++|             ",
                ".........   ......|++|X+++++++++++X| :+++: |****|+++|****|++|......   ........          |%%%***%%|%%|******|    |**%******|   |++++|++++|+++++|             ",
                ".........   ......|++|X++XXXXXXXX+X|  +++  |--O--+++--O--|++|......   ........          |%%%%***%|%%-******|    |*%%%**%**|   |++++|++++|++|---             ",
                ".........   ......|++|X++|-----|X+X|  +++  |+++++++++++++|++|......   ........          ------|**|%%%%*||**-####-%%%|-|%%*-###-++|-|++---++|                ",
                ".........   ......|++|X++|%%%%%|X+X| :+++: |--O-|+++|-O--|++|......   ........                |*%|%%***||********%%%|-|%%%*****++|||+++++++|                ",
                ".........   ......|++|X++|*****|X+X|::+++::|****|+++|****|++|......   ........                |%%---|---|*******%%%%---%%******++|||+++++++|                ",
                ".........   ......|++|X++|#####|X+X| :+++: |#***|+++|***#|++|......   ........                |%%%**|----**|####|%%%%*%%%%|###|++----|++|---                ",
                ".........   ......|++|X++|*****|X+X|  +++  |-----+++-----|++|......   ........                |%%%%*|******|    |%%%***%%%|   |+++++||++|                   ",
                ".........   ......|++|X++----**|X+X|  +++  |X+++++++++++%|++|......   ........                ---|**|%*****|    |%%*****%%|   |+++++||++|                   ",
                ".........   ......|++|X++++++++|X+X|  +++  |XX+++++++++%%|++|......   ........                   |*%|%%|----    ---|***|---   ---|++--++|                   ",
                ".........   ......|++|XXXXXXXXX|X+X| :+++: |XXX+++++++%%%|++|......   ........                   |%%|%%|           |***|         |++++++|                   ",
                ".........   ...|---++-----------X+X|::+++::|XXXX+++++%%%%|XX---|...   ........                   |%%-%%|           |***|         |++++++|                   ",
                ".........   ...|::++++++++++++++++X| :+++: |XXXXX+++%%%%%|***$$|...   ........                   |%%%%%|          #|***|#        --------                   ",
                ".........   ...|:+++++++++++++++++X|  +++  |#############|****$|...   ........                   |%%%%%|          #|***|#                                   ",
                ".........   ...|+++++|-------------|  +++  |-------------|*****|...   ........                   -------            +++                                     ",
                ".........   ...|:+++:|.............| :+++: |.............|$***$|...   ........                                      +++                                     ",
                ".........   ...|::+::|.............|::+++::|.............|$$*$$|...   ........                                      +++                                     ",
                ".........    ..-------.............---+++---.............-------..    ........                                      +++                                     ",
                ".........    .....................................................    ........                                      +++                                     ",
                "..........    ...................................................    .........                                      +++                                     ",
                "..........      ......................+++......................      .........                                      +++                                     ",
                "...........                           +++                           ..........                                      +++                                     ",
                "............                          +++                          ...........                                      +++                                     ",
                "..............                        +++                        .............                                      +++                                     ",
                "......................................+++.....................................                                      +++                                     ",
                "..............................................................................                                      +++                                     ",
                "..............................................................................                                      +++                                     ",
                "..............................................................................                                      +++                                     ",
                "..............................................................................                                      +++                                     ",
                "..............................................................................                                      +++                                     ",
                "..............................................................................                                      +++                                     ",
                "............................................................................................................................................................"
        };

        String[] castilloLB = {
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                "..............                                                   .............",
                "............                                                       ...........",
                "...........                                                         ..........",
                "..........      ..................................                   .........",
                "..........    .....................................          ....    .........",
                ".........    .......................................        ......    ........",
                ".........    ..|-----|..........|-------------|.....    .|-----|..    ........",
                ".........   ...|::+::|..........O+++++++++++++|....    ..|::+::|...   ........",
                ".........   ...|:+++:|..........|+++++++++++++|...    ...|:+++:|...   ........",
                ".........   ...|+++++------------++|-------|++------------+++++|...   ........",
                ".........   ...|:++++++++++++++++++|#######|++++++++++++++++++:|...   ........",
                ".........   ...|::+++++++++++++++++|::###::|+++++++++++++++++::|...   ........",
                ".........   ...---|++|-------|-+++-|:*#*#*:|-----|---|---|++|---...   ........",
                ".........   ......|++|---O---|+++++|*******|#####|+++-$$$|++|......   ........",
                ".........   ......|++|*#***#*|+++++|*******|#####-+++O*$$|++|......   ........",
                ".........    .....|++|*#***#*|+++++|*******|+++++X+++|**$|++|......   ........",
                ".........    .....|++|*#####*|+++++O*******|+++++X+++|---|++|......   ........",
                ".........     ....|++|*******|--+--|--***--|+++++X+++-**$|++|......   ........",
                ".........      ...|++|--***--|+++++|::+++::|+++++|+++O*$$|++|......   ........",
                ".........       ..|++|+++++++|+++++|:+++++:|+++++|+++|$$$|++|......   ........",
                "..........      ..|++|+##+##+|------+++++++--+++|---|----|++|......   ........",
                "...........      .|++|+++++++|++++++++++++++++++|***|**#*|++|......   ........",
                "...........       |++|+##+##+|++++++++++++++++++|---|**##|++|......   ........",
                "............      |++|+++++++|++++++++++++++++++|********|++|......   ........",
                "............      |++|+##+##+--++|----+++----|++|***|****|++|......   ........",
                "...........      .|++|+++++++++++|:::+++++:::|++-------**|++|......   ........",
                "...........     ..|++|++++++++++:|::+++++++::|+++++++++++|++|......   ........",
                "..........      ..|++|-------|+::|:+++++++++:|+++++++++++|++|......   ........",
                "..........     ...|++|*******|----++++   ++++-------|----|++|......   ........",
                ".........      ...|++|**|---*|+++++++     ++++++++++|++++|++|......   ........",
                ".........     ....|++|**|*#**|+++++++     ++++++++++O++++|++|......   ........",
                ".........     ....|++|**|*#**|+++++++     ++++++++++|++++|++|......   ........",
                ".........    .....|++|**--|**|++++++++   ++++|-------++++|++|......   ........",
                ".........    .....|++|****|**|++++++++++++++:|+++++++++++|++|......   ........",
                ".........   ......|++|--**----+++++++++++++::|+-+++++++++|++|......   ........",
                ".........   ......|++|++++++++++++++++++++:::|+++++++++++|++|......   ........",
                ".........   ......|++|-------------|--+++--|----|+++|----|++|......   ........",
                ".........   ......|++|XXXXXXXXXXXXX|::+++::|#***|+++|***#|++|......   ........",
                ".........   ......|++|X+++++++++++X| :+++: |****|+++|****|++|......   ........",
                ".........   ......|++|X++XXXXXXXX+X|  +++  |--O--+++--O--|++|......   ........",
                ".........   ......|++|X++|-----|X+X|  +++  |+++++++++++++|++|......   ........",
                ".........   ......|++|X++|%%%%%|X+X| :+++: |--O-|+++|-O--|++|......   ........",
                ".........   ......|++|X++|*****|X+X|::+++::|****|+++|****|++|......   ........",
                ".........   ......|++|X++|#####|X+X| :+++: |#***|+++|***#|++|......   ........",
                ".........   ......|++|X++|*****|X+X|  +++  |-----+++-----|++|......   ........",
                ".........   ......|++|X++----**|X+X|  +++  |X+++++++++++%|++|......   ........",
                ".........   ......|++|X++++++++|X+X|  +++  |XX+++++++++%%|++|......   ........",
                ".........   ......|++|XXXXXXXXX|X+X| :+++: |XXX+++++++%%%|++|......   ........",
                ".........   ...|---++-----------X+X|::+++::|XXXX+++++%%%%|XX---|...   ........",
                ".........   ...|::++++++++++++++++X| :+++: |XXXXX+++%%%%%|***$$|...   ........",
                ".........   ...|:+++++++++++++++++X|  +++  |#############|****$|...   ........",
                ".........   ...|+++++|-------------|  +++  |-------------|*****|...   ........",
                ".........   ...|:+++:|.............| :+++: |.............|$***$|...   ........",
                ".........   ...|::+::|.............|::+++::|.............|$$*$$|...   ........",
                ".........    ..-------.............---+++---.............-------..    ........",
                ".........    .....................................................    ........",
                "..........    ...................................................    .........",
                "..........      ......................+++......................      .........",
                "...........                           +++                           ..........",
                "............                          +++                          ...........",
                "..............                        +++                        .............",
                "......................................+++.....................................",
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                "..............................................................................",
                ".............................................................................."
        };
        String[] castilloEX = {
                "                                                                              ",
                "                                                                              ",
                "                                                                              ",
                "                                                                              ",
                "                                                                              ",
                "                                                                              ",
                "                                                                              ",
                "                                                                              ",
                "                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
                "                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
                "                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
                "                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
                "                              |----------------|%%%%%%%%%%%%%%%%%%%%%%%       ",
                "                              |   ###%%%%###   |%%%%%%%%%%%%%%%%%%%%%%%       ",
                "                              |   ##      ##   |%%%%%%%%%%%%%%%%%%%%%%%       ",
                "                    |------|  |   #  ****  #   |%%%%%%%%%%%%%%%%%%%%%%%       ",
                "                    |******|  |     #****#     |%%%%%%%%%%%%%%%%%%%%%%%       ",
                "       |--------|----******---|     #****#     |---------###%%%%%%%%%%%       ",
                "       |===*****|******||*****|     #****#     |%%%*****O**#%%%%%%%%%%%       ",
                "       |+===****|XX****||*****|    ###**###    |%%******|**#%%%%%%%%%%%       ",
                "       |++|------XX|-----O-|**|    #%%**%%#    |%**|-----###%%%%%%%%%%%       ",
                "       |++|******XX|*******|**|    #%%**%%#    |%****|%%%%%%%%%%%%%%%%%       ",
                "       |++|********|*******|**|    #%%**%%#    |*****|%%%%%%%%%%%%%%%%%       ",
                "       |++|-**------**-|---|**|    ###**###    |*****|%%%%%%%%%%%%%%%%%       ",
                "       |++|#**#%%%%#**#|%%%|**-------****-------**|**|%%%%%%%%%%%%%%%%%       ",
                "       |++|%**%%%%%%***|%%%|**********************|**|%%%%%%%%%%%%%%%%%       ",
                "       |++|%**%|-|%%***|%%%|**********************|XX|%%%%%%%%%%%%%%%%%       ",
                "       |++|**%%|-|%%#**|%%=|-------------|--|-----|XX---|%%%%%%%%%%%%%%       ",
                "       |++|***%---%%***|%==|    *****    |**|=%%%%|XX***|%%%%%%%%%%%%%%       ",
                "       |++|*#*%***%***%|===|             |**|==%%%|*****-----------|--|       ",
                "       |++|%*********#%|===|     ***     |**|===|---||***%#%#%#%-**|%%|       ",
                "       |++|%%*|***|*%%%|+==|    *+++*    |**|===||++||**********O**O*%|       ",
                "       |++|%%%|***|%%%%|++=|    **+***   --O|=+=||++|-***%#%#%#%-**|%%|       ",
                "       |++-----***------+++|    |#+#|*    **|+++||++|***|----------|%%|       ",
                "       |++++++++++++++XX+++|    |+++|*******|+++--++|***-******%%%%|%%|       ",
                "       |++++++++++++++XX+++------#+#---------+++XX++|***********%%%|%%|       ",
                "       --------|-------|+++++++#=+++=#++++++++++XX++|***********%%%|%%|       ",
                "               |%%%%%%||++++++++++++++++++++++++|--------**%%***%%%|%%|       ",
                "          |-----%%%%%%||++++++++++++++++++++++++|++++++++%%%%%***%%|%%|       ",
                "          |*%%%%%%||%%|------------------***----|+++++++%%%%%%***%*|%%|       ",
                "          |**%%*%%||%%|                ##***#   |++--|-|%%%%%%%*****%%|       ",
                "          |%*|-O------|               #*****#   |++++|||%%%%%%***%***%|       ",
                "          |**|%*%%%%%%|               #****#    |++++|||+%%%%%**%%%|---       ",
                "          |**|%%%%%%%%|              #***##     |-|++|||++|---++|---          ",
                "          |*%------|%%|------|    |---***---|   |--++|--++|+++++|             ",
                "          |%%%***%%|%%|******|    |**%******|   |++++|++++|+++++|             ",
                "          |%%%%***%|%%-******|    |*%%%**%**|   |++++|++++|++|---             ",
                "          ------|**|%%%%*||**-####-%%%|-|%%*-###-++|-|++---++|                ",
                "                |*%|%%***||********%%%|-|%%%*****++|||+++++++|                ",
                "                |%%---|---|*******%%%%---%%******++|||+++++++|                ",
                "                |%%%**|----**|####|%%%%*%%%%|###|++----|++|---                ",
                "                |%%%%*|******|    |%%%***%%%|   |+++++||++|                   ",
                "                ---|**|%*****|    |%%*****%%|   |+++++||++|                   ",
                "                   |*%|%%|----    ---|***|---   ---|++--++|                   ",
                "                   |%%|%%|           |***|         |++++++|                   ",
                "                   |%%-%%|           |***|         |++++++|                   ",
                "                   |%%%%%|          #|***|#        --------                   ",
                "                   |%%%%%|          #|***|#                                   ",
                "                   -------            +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     ",
                "                                      +++                                     "
        };

        int[] elPersonaje = { 14, 15 };
        int[] elObjetivo = { 42, 40 };

        int modo = mostrarMenuInicial();

        inicializarMundo(castilloLB);

        do {
            actualizarTiempo();
            if (modo == 1) {
                verAccion(elPersonaje, castilloLB);
            } else if (modo == 2) {
                if (caminoAB.isEmpty()){
                    pathfinder(elPersonaje, elObjetivo, castilloLB);
                    System.out.println("\n".repeat(50));
                } 
                else{
                    int[] nextStep = caminoAB.pollFirst();
                    int direction = direccion(elPersonaje, nextStep);
                    if (direction != NADA) {
                        mover(elPersonaje, direction, castilloLB);
                        elPersonaje[0] = nextStep[0];
                        elPersonaje[1] = nextStep[1];
                    }
                    imprimirMundo(castilloLB, elPersonaje);
                    try {
                        Thread.sleep(200);
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt();
                    }
                }
            }

        } while (jugando && !caminoAB.isEmpty());
        System.out.println("Thanks for playing.");
    }

    static int mostrarMenuInicial() {
        Scanner scanner = new Scanner(System.in);
        System.out.println("Select mode:");
        System.out.println("1. Manual");
        System.out.println("2. Automatic");
        System.out.print("Enter choice (1 or 2): ");

        int choice = scanner.nextInt();
        while (choice != 1 && choice != 2) {
            System.out.println("Invalid choice!");
            choice = scanner.nextInt();
        }
        return choice;
    }

    private static void inicializarMundo(String[] mundo) {
        viewPort = 7;
        alcanceVision = viewPort / 2;

        minFila = 0 + viewPort;
        minColumna = 0 + viewPort;
        maxFila = mundo.length - (viewPort + 1);
        maxColumna = mundo[0].length() - (viewPort + 1);
    }

    static void actualizarTiempo() {

        hora = hora + 0.2;
        if (hora >= 24) {
            hora = 0;
        }
        calculaAlcanceVision();
    }

    static void calculaAlcanceVision() {

        alcanceVision = viewPort * 2;

        if (hora < 1 || hora > 23) {
            alcanceVision = 1;
        } else if (hora < 3 || hora > 21) {
            alcanceVision = alcanceVision / 5;
        } else if (hora < 4 || hora > 20) {
            alcanceVision = alcanceVision / 5 * 2;
        } else if (hora < 5 || hora > 19) {
            alcanceVision = alcanceVision / 5 * 3;
        } else if (hora < 6 || hora > 18) {
            alcanceVision = alcanceVision / 5 * 4;
        }
    }

    static LinkedList<int[]> caminoAB = new LinkedList<>();

    static void pathfinder(int[] elPersonaje, int[] elObjetivo, String[] castilloLB) {
        int[] deltaFila = {-1, 1, 0, 0};
        int[] deltaColumna = {0, 0, -1, 1};

        Queue<int[]> cola = new LinkedList<>();
        cola.add(new int[]{elPersonaje[0], elPersonaje[1], -1});

        boolean[][] visitado = new boolean[castilloLB.length][castilloLB[0].length()];
        visitado[elPersonaje[0]][elPersonaje[1]] = true;

        int[][][] reconstruccion = new int[castilloLB.length][castilloLB[0].length()][2];
        reconstruccion[elPersonaje[0]][elPersonaje[1]] = new int[]{-1, -1};

        boolean finalizado = false;

        while (!cola.isEmpty() && !finalizado) {
            int[] actual = cola.poll();
            int filaActual = actual[0], columnaActual = actual[1];

            System.out.println("Processing: (" + filaActual + ", " + columnaActual + ")");

            if (filaActual == elObjetivo[0] && columnaActual == elObjetivo[1]) {
                finalizado = true;
                System.out.println("Target reached at: (" + filaActual + ", " + columnaActual + ")");
                break;
            }

            for (int i = 0; i < 4; i++) {
                int nuevaFila = filaActual + deltaFila[i];
                int nuevaColumna = columnaActual + deltaColumna[i];

                if (
                    nuevaFila >= 0 
                    && nuevaColumna >= 0 
                    && nuevaFila < castilloLB.length 
                    && nuevaColumna < castilloLB[0].length() 
                    && !visitado[nuevaFila][nuevaColumna] 
                    && esTransitable(castilloLB, nuevaFila, nuevaColumna)
                    ) {
                    cola.add(new int[]{nuevaFila, nuevaColumna});
                    visitado[nuevaFila][nuevaColumna] = true;
                    reconstruccion[nuevaFila][nuevaColumna] = new int[]{filaActual, columnaActual}; 
                    System.out.println("Added to queue: (" + nuevaFila + ", " + nuevaColumna + ")");
                }
            }
        }

        if (!finalizado) {
            System.out.println("No path found!");
            jugando = false;
        } else {
            int[] trazarCaminoVuelta = {elObjetivo[0], elObjetivo[1]};
            while (!(trazarCaminoVuelta[0] == elPersonaje[0] && trazarCaminoVuelta[1] == elPersonaje[1])) {
                caminoAB.addFirst(trazarCaminoVuelta);
                trazarCaminoVuelta = reconstruccion[trazarCaminoVuelta[0]][trazarCaminoVuelta[1]];
                System.out.println("Tracing path: (" + trazarCaminoVuelta[0] + ", " + trazarCaminoVuelta[1] + ")");
            }
            caminoAB.addFirst(elPersonaje);
        }
    }

    static int direccion(int[] actual, int[] siguiente) {
        int difFila = siguiente[0] - actual[0];
        int difColumna = siguiente[1] - actual[1];

        if (difFila == -1 && difColumna == 0)
            return ARRIBA;
        else if (difFila == 1 && difColumna == 0)
            return ABAJO;
        else if (difFila == 0 && difColumna == -1)
            return IZQUIERDA;
        else if (difFila == 0 && difColumna == 1)
            return DERECHA;
        return NADA;
    }

    static boolean esTransitable(String[] mapa, int fila, int columna) {
        char c = mapa[fila].charAt(columna);
        return c == '.' || c == 'O' || c == '+' || c == '*' || c == '#' || c == ':';
    }

    static void imprimirMundo(String[] castillo, int[] personaje) {
        String elemento;
        Colours.clearConsole();
        imprimirElCielo();
        for (int fila = personaje[FILA] - viewPort; fila <= personaje[FILA] + viewPort; fila++) {
            for (int columna = personaje[COLUMNA] - viewPort; columna <= personaje[COLUMNA] + viewPort; columna++) {

                elemento = mapear('P', modoVisualizacion);
                if (!(fila == personaje[FILA] && columna == personaje[COLUMNA])) {
                    elemento = mapear(castillo[fila].charAt(columna), modoVisualizacion);
                }

                if (!(Math.pow((fila - personaje[FILA]), 2)
                        + Math.pow((columna - personaje[COLUMNA]), 2) <= alcanceVision * alcanceVision)) {
                    elemento = mapear('D', modoVisualizacion);
                }
                System.out.print(elemento);
            }
            System.out.println();
        }
        imprimirStatus(personaje);
    }

    private static void imprimirStatus(int[] personaje) {
        imprimirLinea();
        System.out.print("HORA: [" + (int) hora + "] ");
        System.out.print("/ (" + personaje[FILA] + "," + personaje[COLUMNA] + ")");
        System.out.println(" / SKIN[" + modoVisualizacion + "]");
        imprimirLinea();
    }

    static void imprimirLinea() {
        System.out.println(mapear('B', modoVisualizacion).repeat(viewPort * 2 + 1));
    }

    static String mapear(char elemento, int modoVisualizacion) {
        switch (modoVisualizacion) {
            case VISUALIZACION_NORMAL:
                return mapearNormal(elemento);
            case VISUALIZACION_SIN_COLOR:
                return mapearSinColor(elemento);
            case VISUALIZACION_RAW:
                return mapearRaw(elemento);
            case VISUALIZACION_COLISIONES:
                return tipoTerreno(elemento);
        }
        return "";
    }

    private static String mapearRaw(char elemento) {
        HashMap<String, String> tiles = new HashMap<>();

        tiles.put(" ", " ");
        tiles.put(".", ".");
        tiles.put("-", "-");
        tiles.put("=", "=");
        tiles.put("|", "|");
        tiles.put(":", ":");
        tiles.put("+", "+");
        tiles.put("O", "O");
        tiles.put("#", "#");
        tiles.put("*", "*");
        tiles.put("$", "$");
        tiles.put("X", "X");
        tiles.put("%", "%");
        tiles.put("_", "_");
        tiles.put("~", "~");
        tiles.put("B", "B");
        tiles.put("P", "P");
        tiles.put("D", "D");
        tiles.put("S", "S");
        tiles.put("C", "C");

        return tiles.get("" + elemento);
    }

    static String mapearSinColor(char elemento) {
        HashMap<String, String> tiles = new HashMap<>();

        tiles.put(" ", " ~~ ");
        tiles.put(".", " . .");
        tiles.put("-", "[##]");
        tiles.put("=", "||||");
        tiles.put("|", "[##]");
        tiles.put(":", "oO*o");
        tiles.put("+", "..:.");
        tiles.put("O", "[  ]");
        tiles.put("#", "::::");
        tiles.put("*", "    ");
        tiles.put("$", "$$$$");
        tiles.put("X", "||||");
        tiles.put("%", "%%%%");
        tiles.put("_", "____");
        tiles.put("~", " ~ ~");
        tiles.put("B", "====");
        tiles.put("P", "_()_");
        tiles.put("D", "    ");
        tiles.put("S", " () ");
        tiles.put("C", "    ");

        return tiles.get("" + elemento);
    }

    static String mapearNormal(char elemento) {
        HashMap<String, String> tiles = new HashMap<>();

        tiles.put(" ", Colours.BLUE_BOLD_BRIGHT + Colours.BLUE_BACKGROUND_BRIGHT + " ~~ " + Colours.RESET);
        tiles.put(".", Colours.YELLOW_BRIGHT + Colours.GREEN_BACKGROUND + " . ." + Colours.RESET);
        tiles.put("-", Colours.WHITE + Colours.WHITE_BACKGROUND + "[##]" + Colours.RESET);
        tiles.put("=", Colours.BLACK_BACKGROUND_BRIGHT + "||||" + Colours.RESET);
        tiles.put("|", Colours.WHITE + Colours.WHITE_BACKGROUND + "[##]" + Colours.RESET);
        tiles.put(":", Colours.YELLOW_BRIGHT + Colours.GREEN_BACKGROUND + "oO*o" + Colours.RESET);
        tiles.put("+", Colours.GREEN_BOLD + Colours.YELLOW_BACKGROUND + "..:." + Colours.RESET);
        tiles.put("O", Colours.WHITE_BACKGROUND_BRIGHT + "[  ]" + Colours.RESET);
        tiles.put("#", Colours.BLACK + Colours.RED_BACKGROUND + "::::" + Colours.RESET);
        tiles.put("*", Colours.YELLOW + Colours.YELLOW_BACKGROUND + "    " + Colours.RESET);
        tiles.put("$", Colours.RED_BRIGHT + Colours.YELLOW_BACKGROUND + "$$$$" + Colours.RESET);
        tiles.put("X", Colours.RED_UNDERLINED + Colours.YELLOW_BACKGROUND + "||||" + Colours.RESET);
        tiles.put("%", Colours.GREEN_BOLD + Colours.YELLOW_BACKGROUND + "%%%%" + Colours.RESET);
        tiles.put("_", Colours.BLACK + "____" + Colours.RESET);
        tiles.put("~", Colours.BLUE_BACKGROUND_BRIGHT + " ~ ~" + Colours.RESET);
        tiles.put("B", Colours.BLUE + Colours.BLUE_BACKGROUND + "====" + Colours.RESET);
        tiles.put("P", Colours.RED + "_()_" + Colours.RESET);
        tiles.put("D", Colours.BLACK_BACKGROUND_BRIGHT + "    " + Colours.RESET);
        tiles.put("S", Colours.YELLOW_BOLD_BRIGHT + Colours.BLUE_BACKGROUND + " () " + Colours.RESET);
        tiles.put("C", Colours.BLUE_BACKGROUND + "    " + Colours.RESET);

        return tiles.get("" + elemento);
    }

    static String tipoTerreno(char elemento) {
        HashMap<String, String> tiles = new HashMap<>();

        tiles.put(" ", "1");
        tiles.put(".", "0");
        tiles.put("-", "1");
        tiles.put("=", "0");
        tiles.put("|", "1");
        tiles.put(":", "0");
        tiles.put("+", "0");
        tiles.put("O", "0");
        tiles.put("#", "0");
        tiles.put("*", "0");
        tiles.put("$", "0");
        tiles.put("X", "0");
        tiles.put("%", "0");
        tiles.put("_", "0");
        tiles.put("~", "1");
        tiles.put("B", "0");
        tiles.put("P", "*");
        tiles.put("D", "0");
        tiles.put("S", "0");
        tiles.put("C", "0");

        return tiles.get("" + elemento);
    }

    static void mover(int[] unPersonaje, int direccion, String[] mapa) {
        int oldFila = unPersonaje[FILA];
        int oldColumna = unPersonaje[COLUMNA];

        unPersonaje[FILA] += MOVIMIENTO[direccion][FILA];
        unPersonaje[COLUMNA] += MOVIMIENTO[direccion][COLUMNA];

        if (!tipoTerreno(mapa[unPersonaje[FILA]].charAt(unPersonaje[COLUMNA])).equals("0")) {
            unPersonaje[FILA] = oldFila;
            unPersonaje[COLUMNA] = oldColumna;
        }

        if (unPersonaje[FILA] < minFila) {
            unPersonaje[FILA] = unPersonaje[FILA] + 1;
        }
        if (unPersonaje[FILA] > maxFila) {
            unPersonaje[FILA] = unPersonaje[FILA] - 1;
        }
        if (unPersonaje[COLUMNA] < minColumna) {
            unPersonaje[COLUMNA] = unPersonaje[COLUMNA] + 1;
        }
        if (unPersonaje[COLUMNA] > maxColumna) {
            unPersonaje[COLUMNA] = unPersonaje[COLUMNA] - 1;
        }
    }

    static void verAccion(int[] elPersonaje, String[] elMundo) {
        switch (capturarMovimiento()) {
            case ARRIBA:
                mover(elPersonaje, ARRIBA, elMundo);
                break;
            case ABAJO:
                mover(elPersonaje, ABAJO, elMundo);
                break;
            case IZQUIERDA:
                mover(elPersonaje, IZQUIERDA, elMundo);
                break;
            case DERECHA:
                mover(elPersonaje, DERECHA, elMundo);
                break;
            case SALIR:
                jugando = !jugando;
                break;
            case CAMBIA_VISUALIZACION:
                cambiaVisualizacion();
                break;
            case NADA:
                break;
        }
    }

    static void cambiaVisualizacion() {
        modoVisualizacion++;
        if (modoVisualizacion > 3) {
            modoVisualizacion = 0;
        }
    }

    static int capturarMovimiento() {
        switch (pedirChar()) {
            case 's', 'S', '8':
                return ABAJO;
            case 'w', 'W', '2':
                return ARRIBA;
            case 'a', 'A', '4':
                return IZQUIERDA;
            case 'd', 'D', '6':
                return DERECHA;
            case 'f', 'F':
                return SALIR;
            case 'v', 'V':
                return CAMBIA_VISUALIZACION;
        }
        return NADA;
    }

    static char pedirChar() {
        Scanner entrada = new Scanner(System.in);
        String inputUsuario = entrada.nextLine() + "x";
        return inputUsuario.charAt(0); // Actualización comentada en clase
    }

    static void imprimirElCielo() {
        Colours.clearConsole();
        imprimirLinea();
        for (int i = 0; i < viewPort * 2 + 1; i = i + 1) {
            if ((hora > 6) && (hora <= 18) && (i == (int) (((viewPort * 2)) - ((hora - 7) * (viewPort * 2) / 12)))) {
                System.out.print(mapear('S', modoVisualizacion));
            } else {
                System.out.print(mapear('C', modoVisualizacion));
            }
        }
        System.out.println();
        imprimirLinea();
    }
}